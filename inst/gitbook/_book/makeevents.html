<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Adding events to simulations | Specific examples</title>
  <meta name="description" content="dads R package manual" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Adding events to simulations | Specific examples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="dads R package manual" />
  <meta name="github-repo" content="TGuillerme/dads" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Adding events to simulations | Specific examples" />
  
  <meta name="twitter:description" content="dads R package manual" />
  

<meta name="author" content="Thomas Guillerme (guillert@tcd.ie)" />


<meta name="date" content="2023-03-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="makemodifiers.html"/>
<link rel="next" href="others.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.1.3/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.1.3/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.1.3/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/init.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.1.3/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.1.3/CanvasMatrix.src.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">dads manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> <code>dads</code>: disparity and diversity simulations.</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-dads"><i class="fa fa-check"></i><b>1.1</b> What is <code>dads</code>?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#modular"><i class="fa fa-check"></i><b>1.1.1</b> Modular?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#who-is-this-manual-for"><i class="fa fa-check"></i><b>1.2</b> Who is this manual for?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-and-running-the-package"><i class="fa fa-check"></i><b>1.3</b> Installing and running the package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#help"><i class="fa fa-check"></i><b>1.4</b> Help</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#how-does-dads-work"><i class="fa fa-check"></i><b>1.5</b> How does <code>dads</code> work?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#bdalgorithm"><i class="fa fa-check"></i><b>1.6</b> The birth-death algorithm</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="gettingstarted.html"><a href="gettingstarted.html#the-simplest-of-all-analysis-simulating-diversity-only"><i class="fa fa-check"></i><b>2.1</b> The simplest of all analysis: simulating diversity only</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="gettingstarted.html"><a href="gettingstarted.html#changing-the-birth-death-parameters"><i class="fa fa-check"></i><b>2.1.1</b> Changing the birth-death parameters</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="gettingstarted.html"><a href="gettingstarted.html#slightly-more-complex-simulating-disparity-and-diversity"><i class="fa fa-check"></i><b>2.2</b> Slightly more complex: simulating disparity and diversity</a></li>
<li class="chapter" data-level="2.3" data-path="gettingstarted.html"><a href="gettingstarted.html#slightly-more-more-complex-simulating-linked-disparity-and-diversity"><i class="fa fa-check"></i><b>2.3</b> Slightly more more complex: simulating linked disparity and diversity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="maketraits.html"><a href="maketraits.html"><i class="fa fa-check"></i><b>3</b> Simulating traits</a>
<ul>
<li class="chapter" data-level="3.1" data-path="maketraits.html"><a href="maketraits.html#the-process-process"><i class="fa fa-check"></i><b>3.1</b> The process (<code>process</code>)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="maketraits.html"><a href="maketraits.html#the-syntax-how-to-code-a-process"><i class="fa fa-check"></i><b>3.1.1</b> The syntax (how to code a process?)</a></li>
<li class="chapter" data-level="3.1.2" data-path="maketraits.html"><a href="maketraits.html#using-a-process-in-dads"><i class="fa fa-check"></i><b>3.1.2</b> Using a <code>"process"</code> in <code>dads</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="maketraits.html"><a href="maketraits.html#the-number-of-traits-n-and-the-starting-values-start"><i class="fa fa-check"></i><b>3.2</b> The number of traits <code>n</code> and the starting values <code>start</code></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="maketraits.html"><a href="maketraits.html#what-even-is-a-trait"><i class="fa fa-check"></i><b>3.2.1</b> What even is a trait?</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="maketraits.html"><a href="maketraits.html#extra-argument-for-the-processes-with-process.args"><i class="fa fa-check"></i><b>3.3</b> Extra argument for the processes with <code>process.args</code></a></li>
<li class="chapter" data-level="3.4" data-path="maketraits.html"><a href="maketraits.html#naming-the-traits-with-trait.names"><i class="fa fa-check"></i><b>3.4</b> Naming the traits with <code>trait.names</code></a></li>
<li class="chapter" data-level="3.5" data-path="maketraits.html"><a href="maketraits.html#combining-multiple-traits-with-add"><i class="fa fa-check"></i><b>3.5</b> Combining multiple traits with <code>add</code></a></li>
<li class="chapter" data-level="3.6" data-path="maketraits.html"><a href="maketraits.html#using-a-background-trait"><i class="fa fa-check"></i><b>3.6</b> Using a background trait</a></li>
<li class="chapter" data-level="3.7" data-path="maketraits.html"><a href="maketraits.html#saving-trait-values-at-different-time-steps"><i class="fa fa-check"></i><b>3.7</b> Saving trait values at different time steps</a></li>
<li class="chapter" data-level="3.8" data-path="maketraits.html"><a href="maketraits.html#traits-implemented-in-dads"><i class="fa fa-check"></i><b>3.8</b> Traits implemented in <code>dads</code></a></li>
<li class="chapter" data-level="3.9" data-path="maketraits.html"><a href="maketraits.html#testing-the-traits-with-test"><i class="fa fa-check"></i><b>3.9</b> Testing the traits with <code>test</code></a></li>
<li class="chapter" data-level="3.10" data-path="maketraits.html"><a href="maketraits.html#templates-for-making-your-very-own-process"><i class="fa fa-check"></i><b>3.10</b> Templates for making your very own process</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="maketraits.html"><a href="maketraits.html#a-simple-brownian-motion-process-template"><i class="fa fa-check"></i><b>3.10.1</b> A simple Brownian Motion process template</a></li>
<li class="chapter" data-level="3.10.2" data-path="maketraits.html"><a href="maketraits.html#a-simple-ornstein-uhlenbeck-process-template"><i class="fa fa-check"></i><b>3.10.2</b> A simple Ornstein-Uhlenbeck process template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="makemodifiers.html"><a href="makemodifiers.html"><i class="fa fa-check"></i><b>4</b> Modifying the birth-death process</a>
<ul>
<li class="chapter" data-level="4.1" data-path="makemodifiers.html"><a href="makemodifiers.html#the-default-modifier-how-the-process-is-working"><i class="fa fa-check"></i><b>4.1</b> The default modifier (how the process is working)</a></li>
<li class="chapter" data-level="4.2" data-path="makemodifiers.html"><a href="makemodifiers.html#the-branch-length-function-branch.length"><i class="fa fa-check"></i><b>4.2</b> The branch length function (<code>branch.length</code>)</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="makemodifiers.html"><a href="makemodifiers.html#allowarguments"><i class="fa fa-check"></i><b>4.2.1</b> The allowed arguments</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="makemodifiers.html"><a href="makemodifiers.html#the-selection-function-selection"><i class="fa fa-check"></i><b>4.3</b> The selection function (<code>selection</code>)</a></li>
<li class="chapter" data-level="4.4" data-path="makemodifiers.html"><a href="makemodifiers.html#the-speciation-function-speciation"><i class="fa fa-check"></i><b>4.4</b> The speciation function (<code>speciation</code>)</a></li>
<li class="chapter" data-level="4.5" data-path="makemodifiers.html"><a href="makemodifiers.html#summarymodifiers"><i class="fa fa-check"></i><b>4.5</b> Summary of the inputs and outputs for the <code>branch.length</code>, <code>selection</code> and <code>speciation</code> modifiers</a></li>
<li class="chapter" data-level="4.6" data-path="makemodifiers.html"><a href="makemodifiers.html#the-condition-and-modify-functions-condition-and-modify"><i class="fa fa-check"></i><b>4.6</b> The condition and modify functions (<code>condition</code> and <code>modify</code>)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="makeevents.html"><a href="makeevents.html"><i class="fa fa-check"></i><b>5</b> Adding events to simulations</a>
<ul>
<li class="chapter" data-level="5.1" data-path="makeevents.html"><a href="makeevents.html#target"><i class="fa fa-check"></i><b>5.1</b> Target</a></li>
<li class="chapter" data-level="5.2" data-path="makeevents.html"><a href="makeevents.html#conditions"><i class="fa fa-check"></i><b>5.2</b> Conditions</a></li>
<li class="chapter" data-level="5.3" data-path="makeevents.html"><a href="makeevents.html#modifications"><i class="fa fa-check"></i><b>5.3</b> Modifications</a></li>
<li class="chapter" data-level="5.4" data-path="makeevents.html"><a href="makeevents.html#examples"><i class="fa fa-check"></i><b>5.4</b> Examples</a></li>
<li class="chapter" data-level="5.5" data-path="makeevents.html"><a href="makeevents.html#founding"><i class="fa fa-check"></i><b>5.5</b> Founding events</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="others.html"><a href="others.html"><i class="fa fa-check"></i><b>6</b> Other functionalities</a>
<ul>
<li class="chapter" data-level="6.1" data-path="others.html"><a href="others.html#makebdparams"><i class="fa fa-check"></i><b>6.1</b> <code>make.bd.params</code></a></li>
<li class="chapter" data-level="6.2" data-path="others.html"><a href="others.html#dropthings"><i class="fa fa-check"></i><b>6.2</b> <code>drop.things</code></a></li>
<li class="chapter" data-level="6.3" data-path="others.html"><a href="others.html#dads-internal-utilities"><i class="fa fa-check"></i><b>6.3</b> <code>"dads"</code> internal utilities</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plotting-traits.html"><a href="plotting-traits.html"><i class="fa fa-check"></i><b>7</b> Plotting traits</a></li>
<li class="chapter" data-level="8" data-path="plotting-dads-results.html"><a href="plotting-dads-results.html"><i class="fa fa-check"></i><b>8</b> Plotting dads results</a>
<ul>
<li class="chapter" data-level="8.1" data-path="plotting-dads-results.html"><a href="plotting-dads-results.html#d-version"><i class="fa fa-check"></i><b>8.1</b> 3D version!</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="specific-examples.html"><a href="specific-examples.html"><i class="fa fa-check"></i><b>9</b> Specific examples</a>
<ul>
<li class="chapter" data-level="9.1" data-path="specific-examples.html"><a href="specific-examples.html#EGrandom_ext"><i class="fa fa-check"></i><b>9.1</b> Random mass extinction after some time</a></li>
<li class="chapter" data-level="9.2" data-path="specific-examples.html"><a href="specific-examples.html#EGneg_ext"><i class="fa fa-check"></i><b>9.2</b> Species with negative trait values go extinct after some time</a></li>
<li class="chapter" data-level="9.3" data-path="specific-examples.html"><a href="specific-examples.html#EGbg_ext"><i class="fa fa-check"></i><b>9.3</b> Adding a background extinction after reaching a number of living taxa</a></li>
<li class="chapter" data-level="9.4" data-path="specific-examples.html"><a href="specific-examples.html#EGred_spec"><i class="fa fa-check"></i><b>9.4</b> Reducing speciation rate after some time</a></li>
<li class="chapter" data-level="9.5" data-path="specific-examples.html"><a href="specific-examples.html#EG_change_trait"><i class="fa fa-check"></i><b>9.5</b> Changing the trait process after some time</a></li>
<li class="chapter" data-level="9.6" data-path="specific-examples.html"><a href="specific-examples.html#EG_change_correlation"><i class="fa fa-check"></i><b>9.6</b> Changing trait correlation after reaching a trait value</a></li>
<li class="chapter" data-level="9.7" data-path="specific-examples.html"><a href="specific-examples.html#EG_change_modif"><i class="fa fa-check"></i><b>9.7</b> Event for changing a modifier: speciation event increase for species with negative values</a></li>
<li class="chapter" data-level="9.8" data-path="specific-examples.html"><a href="specific-examples.html#EG_modify_brlen"><i class="fa fa-check"></i><b>9.8</b> Changing branch length when reaching n taxa</a></li>
<li class="chapter" data-level="9.9" data-path="specific-examples.html"><a href="specific-examples.html#EG_founding_purebirth"><i class="fa fa-check"></i><b>9.9</b> Founding event: a generating a subtree with no fossils</a></li>
<li class="chapter" data-level="9.10" data-path="specific-examples.html"><a href="specific-examples.html#EG_founding_traits"><i class="fa fa-check"></i><b>9.10</b> Founding event: a generating a subtree a different process</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/TGuillerme/dads/" target="blank">Project GitHub page</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Specific examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="makeevents" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Adding events to simulations<a href="makeevents.html#makeevents" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One other major feature of the <code>dads</code> package is to allow simulations to run with specified events to occur during the simulation.
These are typically events that can drastically change the course of the simulation.
For example, you might want simulate some mass extinction at some specific point in time.
However, these can also be more subtle, like the internal change of parameter values when reaching a specific trait value.
These are all handled by <code>dads</code> with the <code>events</code> object that you can create using <code>make.events</code> and has the same overall logic as <code>make.traits</code> and <code>make.modifiers</code>.</p>
<p><code>events</code> require three main arguments:
* the <code>target</code> which designates what the extinction should affect (e.g. the taxa, the speciation rate, etc…);
* the <code>condition</code> which designates when to trigger the event;
* the <code>modification</code> which designates what to exactly modify when the event is triggered.</p>
<p>There are several more arguments that can be passed to <code>make.events</code> but they are discussed later on.
First let’s focus on these three main arguments:</p>
<div id="target" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Target<a href="makeevents.html#target" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The target of the event is what the event is going to modify in the birth-death algorithm.
You can only have one target per event (along with one condition and one modification) but you can create events that contain multiple events (i.e. multiple triplets of target/condition/modification).
The targets that are currently available are:
* <code>"taxa"</code> to modify anything linked to the <a href="makemodifiers.html#allowarguments"><code>lineage</code> list</a>. E.g. making half of the living taxa go extinct.
* <code>"bd.params"</code> to modify anything linked to the <a href="others.html#makebdparams"><code>bd.params</code> object</a>. For example you might want to change the distribution of one of the parameter after some <code>conditions</code>. This is typically done by updating the object using the argument <code>update</code> from <code>make.bd.params</code>.
* <code>"traits"</code> to modify anything linked to the <a href="maketraits.html#maketraits"><code>traits</code> object</a>. For example you might want to change the trait process after some <code>conditions</code>. This is typically done by updating the object using the argument <code>update</code> from <code>make.traits</code>.
* <code>"modifiers"</code> to modify anything linked to the <a href="#makebdmodifiers"><code>modifiers</code> object</a>. For example you might want to change the speciation rule after some <code>conditions</code>. This is typically done by updating the object using the argument <code>update</code> from <code>make.modifiers</code>.
* <code>"founding"</code> this target is a bit more special and allows you run a nested <code>dads</code> object in the simulation. It is cover in a <a href="makeevents.html#founding">specific section below</a>.</p>
<p>We will see some example of these targets by illustrating the <code>conditions</code> and <code>modifications</code> below.</p>
</div>
<div id="conditions" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Conditions<a href="makeevents.html#conditions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>condition</code> is a function that returns a logical value. When a specific condition is met, it should return <code>TRUE</code> and trigger the event, else it should return <code>FALSE</code>.</p>
<p>Currently there are three conditions functions implemented in <code>dads</code> but you can easily come up with your own version of them.</p>
<p>All <code>condition</code> functions in <code>dads</code> take at least to arguments: <code>x</code> for the variable of interest (e.g. time, number of taxa, trait value, etc…) and <code>condition</code>, the relational operator to evaluate. A relational operator is the proper (fancy) term designating all the comparisons you’re regularly using in <code>R</code> like <code>==</code> (is equal?) <code>&lt;</code> (is smaller?) <code>&gt;=</code> (is bigger or equal?). You can get the full list in the base manual (using <code>?Comparison</code> or any of the relational operator in a function form).</p>
<blockquote>
<p>Note on the function form of a operator in <code>R</code>: if you weren’t aware, functions in <code>R</code> are <em>usually</em> described in the format <code>function(arguments)</code>, however many other functions you are commonly using are written as operators, for example (<code>1 + 1</code>). These are still functions though! And you can always use them in the classic function format by quoting them in back ticks: the following does the same as <code>(1+1)</code>: <code>`+`(1, 1)</code>. You can use that for parsing your relational operators as functions in <code>condition</code>. If you want you condition to be equal, use the syntax <code>condition = `==`</code>. More details on how functions <em>really</em> work in the <a href="https://adv-r.hadley.nz/functions.html">Advanced <code>R</code> book</a>!</p>
</blockquote>
<ul>
<li><code>time.condition</code> will trigger the <code>event</code> once a certain time is reached in the simulations and is the simplest/more basic condition with no arguments other than the time required. For example <code>time.condition(4, condition = `==`)</code> will trigger the <code>event</code> once the simulations reached 4 units of time. Easy.</li>
<li><code>taxa.condition</code> will trigger the <code>event</code> once a certain number of taxa is reached. This can be considered including or excluding fossil species. For example <code>taxa.condition(42, condition = `&gt;=`, living = TRUE)</code> will trigger the <code>event</code> if there is at least 42 living species.</li>
<li><code>trait.condition</code> will trigger the <code>event</code> once a certain trait value is reached. This function allows to say which trait(s) to target (by default, the first one using <code>trait = 1</code>), what value of the trait to target (by default <code>what = max</code>) and whether to use and absolute trait value or not (<code>absolute = TRUE</code>). For example <code>trait.condition(1/3, condition = `&gt;`, trait = 1, what = sd)</code> will trigger the condition after the standard deviation of the first trait reaches 1/3.</li>
</ul>
</div>
<div id="modifications" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Modifications<a href="makeevents.html#modifications" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After defining the <code>event</code>’s <code>target</code> and <code>condition</code>, you’ll need to also specify what it should modify.
These are basically functions that should modify a specific aspect of the target
Depending on the target you can modify the following:</p>
<ul>
<li>if the target is <code>"taxa"</code> you can modify the internal <a href="makemodifiers.html#allowarguments"><code>lineage</code> list</a> by removing living species using <code>random.extinction</code> or <code>trait.extinction</code>.</li>
<li>if the target is <code>"taxa"</code> you can modify the lineage tracker by removing living species using <code>random.extinction</code> or <code>trait.extinction</code>.</li>
<li>if the target is <code>"bd.params"</code> you can modify the <a href="others.html#makebdparams"><code>bd.params</code> object</a> using <code>update.bd.params</code>.</li>
<li>if the target is <code>"traits"</code> you can modify the <a href="maketraits.html#maketraits"><code>traits</code> object</a> using <code>update.traits</code>.</li>
<li>if the target is <code>"modifiers"</code> you can modify the <a href="makemodifiers.html#makemodifiers"><code>modifiers</code> object</a> using <code>update.modifiers</code>.</li>
<li>(for the <code>"founding"</code> target <a href="makeevents.html#founding">see below</a>)</li>
</ul>
<p>The most straightforward example if for <code>modifications</code> on <code>bd.params</code>, <code>traits</code> or <code>modifiers</code> objects since they use the same syntax as for their generic <code>make.X</code> function.
For example, for <code>make.traits</code>, you can update a <code>trait</code> using the <code>update</code> argument as follows:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="makeevents.html#cb108-1" aria-hidden="true"></a><span class="co">## A BM trait in two dimensions</span></span>
<span id="cb108-2"><a href="makeevents.html#cb108-2" aria-hidden="true"></a>(BM_2D &lt;-<span class="st"> </span><span class="kw">make.traits</span>(<span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">process =</span> BM.process))</span></code></pre></div>
<pre><code>##  ---- dads traits object ---- 
## 2 traits for 1 process (A:2) with one starting value (0).</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="makeevents.html#cb110-1" aria-hidden="true"></a><span class="co">## Updating the 2D BM into a 2D OU</span></span>
<span id="cb110-2"><a href="makeevents.html#cb110-2" aria-hidden="true"></a>(OU_2D &lt;-<span class="st"> </span><span class="kw">make.traits</span>(<span class="dt">update =</span> BM_2D, <span class="dt">process =</span> OU.process))</span></code></pre></div>
<pre><code>##  ---- dads traits object ---- 
## 2 traits for 1 process (A:2) with one starting value (0).</code></pre>
<p>So basically the functions <code>update.X</code> apply the update to the object <code>X</code> when the event happens.
The following <code>event</code> updates the <code>bd.params</code> object by setting the extinction parameter to 1/3 when reaching a 10 species:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="makeevents.html#cb112-1" aria-hidden="true"></a><span class="kw">make.events</span>(<span class="dt">target       =</span> <span class="st">&quot;bd.params&quot;</span>,</span>
<span id="cb112-2"><a href="makeevents.html#cb112-2" aria-hidden="true"></a>            <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">10</span>, <span class="dt">condition =</span> <span class="st">`</span><span class="dt">&gt;=</span><span class="st">`</span>),</span>
<span id="cb112-3"><a href="makeevents.html#cb112-3" aria-hidden="true"></a>            <span class="dt">modification =</span> <span class="kw">update.bd.params</span>(<span class="dt">extinction =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))</span></code></pre></div>
<blockquote>
<p>Note that by default events are triggered only once in the whole simulation, so although the example above states that the condition is reaching at least 10 taxa, it will not trigger every times it reaches more than 10 taxa. You can change the number of times the events can be triggered using the argument <code>replications</code> (by default it’s set to <code>replications = 0</code> for triggering it only once).</p>
</blockquote>
</div>
<div id="examples" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Examples<a href="makeevents.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here are some example illustrating how to generate events.
For a simple example, we can create a extinction event that will remove 80% of species after reaching time 4:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="makeevents.html#cb113-1" aria-hidden="true"></a><span class="co">## 80% mass extinction at time 4</span></span>
<span id="cb113-2"><a href="makeevents.html#cb113-2" aria-hidden="true"></a>mass_extinction &lt;-<span class="st"> </span><span class="kw">make.events</span>(</span>
<span id="cb113-3"><a href="makeevents.html#cb113-3" aria-hidden="true"></a>                      <span class="dt">target       =</span> <span class="st">&quot;taxa&quot;</span>,</span>
<span id="cb113-4"><a href="makeevents.html#cb113-4" aria-hidden="true"></a>                      <span class="dt">condition    =</span> <span class="kw">time.condition</span>(<span class="dv">4</span>),</span>
<span id="cb113-5"><a href="makeevents.html#cb113-5" aria-hidden="true"></a>                      <span class="dt">modification =</span> <span class="kw">random.extinction</span>(<span class="fl">0.8</span>))</span>
<span id="cb113-6"><a href="makeevents.html#cb113-6" aria-hidden="true"></a></span>
<span id="cb113-7"><a href="makeevents.html#cb113-7" aria-hidden="true"></a><span class="co">## Simulation parameters</span></span>
<span id="cb113-8"><a href="makeevents.html#cb113-8" aria-hidden="true"></a>stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">5</span>)</span>
<span id="cb113-9"><a href="makeevents.html#cb113-9" aria-hidden="true"></a>bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</span>
<span id="cb113-10"><a href="makeevents.html#cb113-10" aria-hidden="true"></a></span>
<span id="cb113-11"><a href="makeevents.html#cb113-11" aria-hidden="true"></a><span class="co">## Running the simulations</span></span>
<span id="cb113-12"><a href="makeevents.html#cb113-12" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb113-13"><a href="makeevents.html#cb113-13" aria-hidden="true"></a>results &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</span>
<span id="cb113-14"><a href="makeevents.html#cb113-14" aria-hidden="true"></a>                <span class="dt">stop.rule =</span> stop.rule,</span>
<span id="cb113-15"><a href="makeevents.html#cb113-15" aria-hidden="true"></a>                <span class="dt">events    =</span> mass_extinction)</span>
<span id="cb113-16"><a href="makeevents.html#cb113-16" aria-hidden="true"></a><span class="co">## Plotting the results</span></span>
<span id="cb113-17"><a href="makeevents.html#cb113-17" aria-hidden="true"></a><span class="kw">plot</span>(results, <span class="dt">show.tip.label =</span> <span class="ot">FALSE</span>)</span>
<span id="cb113-18"><a href="makeevents.html#cb113-18" aria-hidden="true"></a><span class="kw">axisPhylo</span>()</span></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Or for a slightly more complex example, we can can change the trait process from a BM to an OU when the trait values reaches an upper 95% quantile value above 2:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="makeevents.html#cb114-1" aria-hidden="true"></a><span class="co">## The 95% upper quantile value of a distribution</span></span>
<span id="cb114-2"><a href="makeevents.html#cb114-2" aria-hidden="true"></a>upper<span class="fl">.95</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb114-3"><a href="makeevents.html#cb114-3" aria-hidden="true"></a>    <span class="kw">return</span>(<span class="kw">quantile</span>(x, <span class="dt">prob =</span> <span class="fl">0.95</span>))</span>
<span id="cb114-4"><a href="makeevents.html#cb114-4" aria-hidden="true"></a>} </span>
<span id="cb114-5"><a href="makeevents.html#cb114-5" aria-hidden="true"></a><span class="co">## Create an event to change the trait process</span></span>
<span id="cb114-6"><a href="makeevents.html#cb114-6" aria-hidden="true"></a>change_process &lt;-<span class="st"> </span><span class="kw">make.events</span>(</span>
<span id="cb114-7"><a href="makeevents.html#cb114-7" aria-hidden="true"></a>                  <span class="dt">target       =</span> <span class="st">&quot;traits&quot;</span>,</span>
<span id="cb114-8"><a href="makeevents.html#cb114-8" aria-hidden="true"></a>                  <span class="co">## condition is triggered if(upper.95(x) &gt; 3)</span></span>
<span id="cb114-9"><a href="makeevents.html#cb114-9" aria-hidden="true"></a>                  <span class="dt">condition    =</span> <span class="kw">trait.condition</span>(<span class="dv">3</span>, <span class="dt">condition =</span> <span class="st">`</span><span class="dt">&gt;</span><span class="st">`</span>, <span class="dt">what =</span> upper<span class="fl">.95</span>),</span>
<span id="cb114-10"><a href="makeevents.html#cb114-10" aria-hidden="true"></a>                  <span class="dt">modification =</span> <span class="kw">update.traits</span>(<span class="dt">process =</span> OU.process))</span>
<span id="cb114-11"><a href="makeevents.html#cb114-11" aria-hidden="true"></a></span>
<span id="cb114-12"><a href="makeevents.html#cb114-12" aria-hidden="true"></a><span class="co">## Set the simulation parameters</span></span>
<span id="cb114-13"><a href="makeevents.html#cb114-13" aria-hidden="true"></a>bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</span>
<span id="cb114-14"><a href="makeevents.html#cb114-14" aria-hidden="true"></a>stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">6</span>)</span>
<span id="cb114-15"><a href="makeevents.html#cb114-15" aria-hidden="true"></a>traits    &lt;-<span class="st"> </span><span class="kw">make.traits</span>()</span>
<span id="cb114-16"><a href="makeevents.html#cb114-16" aria-hidden="true"></a></span>
<span id="cb114-17"><a href="makeevents.html#cb114-17" aria-hidden="true"></a><span class="co">## Run the simulations</span></span>
<span id="cb114-18"><a href="makeevents.html#cb114-18" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb114-19"><a href="makeevents.html#cb114-19" aria-hidden="true"></a>no_change &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</span>
<span id="cb114-20"><a href="makeevents.html#cb114-20" aria-hidden="true"></a>                  <span class="dt">stop.rule =</span> stop.rule,</span>
<span id="cb114-21"><a href="makeevents.html#cb114-21" aria-hidden="true"></a>                  <span class="dt">traits    =</span> traits)</span>
<span id="cb114-22"><a href="makeevents.html#cb114-22" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb114-23"><a href="makeevents.html#cb114-23" aria-hidden="true"></a>process_change &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</span>
<span id="cb114-24"><a href="makeevents.html#cb114-24" aria-hidden="true"></a>                       <span class="dt">stop.rule =</span> stop.rule,</span>
<span id="cb114-25"><a href="makeevents.html#cb114-25" aria-hidden="true"></a>                       <span class="dt">traits    =</span> traits,</span>
<span id="cb114-26"><a href="makeevents.html#cb114-26" aria-hidden="true"></a>                       <span class="dt">events    =</span> change_process)</span>
<span id="cb114-27"><a href="makeevents.html#cb114-27" aria-hidden="true"></a><span class="co">## Plot the results</span></span>
<span id="cb114-28"><a href="makeevents.html#cb114-28" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb114-29"><a href="makeevents.html#cb114-29" aria-hidden="true"></a><span class="kw">plot</span>(no_change, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb114-30"><a href="makeevents.html#cb114-30" aria-hidden="true"></a><span class="kw">plot</span>(process_change, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>))</span></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="founding" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Founding events<a href="makeevents.html#founding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Founding events are a specific <code>target</code> for <code>events</code> that allows you to… simulate a birth-death process within the current one!
It basically allows you to simulate a specific <code>dads</code> process i.e. using the <code>dads</code> function with it’s own <code>traits</code>, <code>modifiers</code>, <code>bd.params</code> and <code>events</code> (and yes, that’s including <code>events</code> that have their own <code>founding</code> event)…
This is basically the ultimate nested boss of modularity!</p>
<p>The founding event will basically run an internal <code>dads</code> process (i.e. simulating a tree and, optionally, some data) resulting in a founding sub-tree.
It will then branch this sub-tree to the rest of the simulation that continued normally in the mean time.
You can specify the founding event using the inbuilt <code>founding.event</code> modification event.
This function intakes the exact same arguments as <code>dads</code> to simulate the sub-tree with its own parameters.
Additionally, we will use the <code>additional.args</code> argument from <code>make.events</code> to specify a prefix for the founding tree tips (to make them easier to distinguish).</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="makeevents.html#cb115-1" aria-hidden="true"></a><span class="co">## Set up parameters</span></span>
<span id="cb115-2"><a href="makeevents.html#cb115-2" aria-hidden="true"></a>stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">4</span>)</span>
<span id="cb115-3"><a href="makeevents.html#cb115-3" aria-hidden="true"></a>bd.params &lt;-<span class="st"> </span><span class="kw">make.bd.params</span>(<span class="dt">speciation =</span> <span class="dv">1</span>, <span class="dt">extinction =</span> <span class="fl">0.3</span>)</span>
<span id="cb115-4"><a href="makeevents.html#cb115-4" aria-hidden="true"></a></span>
<span id="cb115-5"><a href="makeevents.html#cb115-5" aria-hidden="true"></a><span class="co">## Events that generate a new process (founding tree - with no extinction)</span></span>
<span id="cb115-6"><a href="makeevents.html#cb115-6" aria-hidden="true"></a>founding_event &lt;-<span class="st"> </span><span class="kw">make.events</span>(</span>
<span id="cb115-7"><a href="makeevents.html#cb115-7" aria-hidden="true"></a>                  <span class="dt">target       =</span> <span class="st">&quot;founding&quot;</span>,</span>
<span id="cb115-8"><a href="makeevents.html#cb115-8" aria-hidden="true"></a>                  <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">10</span>),</span>
<span id="cb115-9"><a href="makeevents.html#cb115-9" aria-hidden="true"></a>                  <span class="dt">modification =</span> <span class="kw">founding.event</span>(</span>
<span id="cb115-10"><a href="makeevents.html#cb115-10" aria-hidden="true"></a>                                    <span class="dt">bd.params =</span> <span class="kw">make.bd.params</span>(<span class="dt">speciation =</span> <span class="dv">2</span>,</span>
<span id="cb115-11"><a href="makeevents.html#cb115-11" aria-hidden="true"></a>                                                               <span class="dt">extinction =</span> <span class="dv">0</span>)),</span>
<span id="cb115-12"><a href="makeevents.html#cb115-12" aria-hidden="true"></a>                  <span class="dt">additional.args =</span> <span class="kw">list</span>(<span class="dt">prefix =</span> <span class="st">&quot;founding_&quot;</span>))</span>
<span id="cb115-13"><a href="makeevents.html#cb115-13" aria-hidden="true"></a>    </span>
<span id="cb115-14"><a href="makeevents.html#cb115-14" aria-hidden="true"></a><span class="co">## Simulations</span></span>
<span id="cb115-15"><a href="makeevents.html#cb115-15" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb115-16"><a href="makeevents.html#cb115-16" aria-hidden="true"></a>founding_tree &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</span>
<span id="cb115-17"><a href="makeevents.html#cb115-17" aria-hidden="true"></a>                      <span class="dt">stop.rule =</span> stop.rule,</span>
<span id="cb115-18"><a href="makeevents.html#cb115-18" aria-hidden="true"></a>                      <span class="dt">events    =</span> founding_event)</span>
<span id="cb115-19"><a href="makeevents.html#cb115-19" aria-hidden="true"></a><span class="kw">plot</span>(founding_tree, <span class="dt">cex =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>Note that the nestedness here is potentially endless, for example, you can parse an <code>event</code> argument to the <code>founding.event</code> that will generate another founding event, etc…</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="makemodifiers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="others.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TGuillerme/dads/inst/gitbook/edit/master/04_make.events.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
